<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>E-shop - Svetry od Franti코ka</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <script src="config.js"></script>
    <style>
        body { font-family: 'Segoe UI', sans-serif; margin: 0; display: flex; flex-direction: column; height: 100vh; background: #f4f4f4; }
        
        header { background: #333; color: white; padding: 15px 5%; display: flex; justify-content: space-between; align-items: center; z-index: 1000; }
        
        .main-content { display: flex; flex: 1; overflow: hidden; }

        /* LEV칄 MENU */
        #side-menu { width: 250px; background: white; border-right: 1px solid #ddd; padding: 20px; overflow-y: auto; }
        .menu-cat { font-weight: bold; margin-top: 15px; cursor: pointer; color: #2c3e50; font-size: 1.1em; display: block; padding: 5px; }
        .menu-sub { padding-left: 20px; cursor: pointer; color: #666; font-size: 0.9em; display: block; padding: 3px 20px; border-radius: 4px; }
        .menu-sub:hover { background: #e9ecef; color: #27ae60; }
        .menu-sub.active { font-weight: bold; color: #27ae60; background: #f0fdf4; }

        /* HLAVN칈 M콎칈콯KA PRODUKT콡 */
        #product-list { flex: 1; padding: 30px; display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 25px; overflow-y: auto; align-content: start; }
        
        .card { background: white; border-radius: 10px; overflow: hidden; box-shadow: 0 4px 10px rgba(0,0,0,0.05); display: flex; flex-direction: column; transition: 0.3s; }
        .card:hover { transform: translateY(-5px); }
        .card img { width: 100%; height: 250px; object-fit: cover; cursor: pointer; }
        .card-info { padding: 15px; text-align: center; }
        .card-price { color: #27ae60; font-weight: bold; font-size: 1.2em; margin-top: 5px; }

        /* MODAL DETAILU */
        .modal { display: none; position: fixed; z-index: 2000; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.85); align-items: center; justify-content: center; padding: 20px; }
        .modal-content { background: white; max-width: 900px; width: 100%; max-height: 90vh; border-radius: 15px; display: flex; overflow: hidden; position: relative; }
        .modal-left { flex: 1.2; background: #000; display: flex; flex-direction: column; }
        .modal-big-img { width: 100%; height: 70%; object-fit: contain; }
        .modal-thumbs { height: 30%; display: flex; gap: 10px; padding: 10px; overflow-x: auto; background: #222; }
        .modal-thumbs img { height: 80px; width: 80px; object-fit: cover; cursor: pointer; opacity: 0.6; }
        .modal-thumbs img:hover { opacity: 1; }
        .modal-right { flex: 1; padding: 40px; overflow-y: auto; }

        .close-btn { position: absolute; top: 15px; right: 20px; font-size: 30px; cursor: pointer; z-index: 10; }
        .buy-btn { background: #27ae60; color: white; border: none; padding: 15px; width: 100%; border-radius: 8px; font-weight: bold; cursor: pointer; margin-top: 20px; }

        #cart-count { background: #e74c3c; color: white; padding: 2px 8px; border-radius: 10px; font-size: 0.8em; }
    </style>
</head>
<body>

<header>
    <h1 style="margin:0;">游빘 Franti코k콢v E-shop</h1>
    <div style="cursor:pointer;" onclick="alert('Ko코칤k se p콏ipravuje')">
        游 Ko코칤k <span id="cart-count">0</span>
    </div>
</header>

<div class="main-content">
    <nav id="side-menu">
        <h3>Kategorie</h3>
        <div id="menu-items">
            </div>
    </nav>

    <main id="product-list">
        </main>
</div>

<div id="prodModal" class="modal">
    <div class="modal-content">
        <span class="close-btn" onclick="zavritModal()">&times;</span>
        <div class="modal-left">
            <img id="modalBigImg" class="modal-big-img">
            <div id="modalThumbs" class="modal-thumbs"></div>
        </div>
        <div class="modal-right">
            <h2 id="modalTitle"></h2>
            <p id="modalDesc" style="color: #555; line-height: 1.6;"></p>
            <div id="modalPrice" style="font-size: 2em; color: #27ae60; font-weight: bold;"></div>
            <button class="buy-btn" onclick="pridatDoKosiku()">Do ko코칤ku</button>
        </div>
    </div>
</div>

<script>
    let vsechnyProdukty = [];
    let vybranaPodkat = null;

    // NA캛칈T츼N칈 Z FIREBASE
    db.ref('produkty').on('value', (snap) => {
        const data = snap.val();
        vsechnyProdukty = data ? Object.values(data) : [];
        vygenerujMenu(data);
        zobrazProdukty();
    });

    // GENEROV츼N칈 LEV칄HO MENU
    function vygenerujMenu(data) {
        const menuItems = document.getElementById('menu-items');
        menuItems.innerHTML = "";
        if (!data) return;

        let struktura = {};
        Object.values(data).forEach(p => {
            if (!struktura[p.kategorie]) struktura[p.kategorie] = new Set();
            struktura[p.kategorie].add(p.podkategorie);
        });

        for (let kat in struktura) {
            let catDiv = document.createElement('div');
            catDiv.className = "menu-cat";
            catDiv.innerText = kat;
            menuItems.appendChild(catDiv);

            struktura[kat].forEach(sub => {
                let subDiv = document.createElement('div');
                subDiv.className = "menu-sub" + (vybranaPodkat === sub ? " active" : "");
                subDiv.innerText = sub;
                subDiv.onclick = () => { vybranaPodkat = sub; zobrazProdukty(); vygenerujMenu(data); };
                menuItems.appendChild(subDiv);
            });
        }
    }

    // ZOBRAZEN칈 PRODUKT콡
    function zobrazProdukty() {
        const list = document.getElementById('product-list');
        list.innerHTML = "";
        
        let filtrovano = vsechnyProdukty;
        if (vybranaPodkat) {
            filtrovano = vsechnyProdukty.filter(p => p.podkategorie === vybranaPodkat);
        }

        filtrovano.forEach(p => {
            list.innerHTML += `
                <div class="card">
                    <img src="${p.img}" onclick='otevriDetail(${JSON.stringify(p)})'>
                    <div class="card-info">
                        <div style="font-size: 0.8em; color: gray;">${p.podkategorie}</div>
                        <strong style="display:block; margin: 5px 0;">${p.jmeno}</strong>
                        <div class="card-price">${p.cena} K캜</div>
                    </div>
                </div>
            `;
        });
    }

    // DETAIL PRODUKTU (MODAL)
    function otevriDetail(p) {
        document.getElementById('prodModal').style.display = 'flex';
        document.getElementById('modalTitle').innerText = p.jmeno;
        document.getElementById('modalDesc').innerText = p.popis || "Bez popisu.";
        document.getElementById('modalPrice').innerText = p.cena + " K캜";
        
        const bigImg = document.getElementById('modalBigImg');
        const thumbs = document.getElementById('modalThumbs');
        
        bigImg.src = p.img;
        thumbs.innerHTML = "";
        
        let galerie = p.galerie || [p.img];
        galerie.forEach(f => {
            const img = document.createElement('img');
            img.src = f;
            img.onclick = () => { bigImg.src = f; };
            thumbs.appendChild(img);
        });
    }

    function zavritModal() { document.getElementById('prodModal').style.display = 'none'; }
    
    let kosikCount = 0;
    function pridatDoKosiku() {
        kosikCount++;
        document.getElementById('cart-count').innerText = kosikCount;
        zavritModal();
    }
</script>

</body>
</html>
